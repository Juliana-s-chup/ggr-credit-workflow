{% load static %}

<header class="navbar" role="banner">
  <div class="navbar-container">
    <!-- Logo / Brand -->
    <div class="navbar-brand">
      <a href="{% url 'home' %}" aria-label="Retour à l'accueil GGR Crédit">
        <svg class="navbar-logo" width="120" height="40" viewBox="0 0 120 40" aria-hidden="true">
          <text x="10" y="28" font-family="Inter" font-weight="700" font-size="24" fill="var(--brand-500)">GGR</text>
          <text x="60" y="28" font-family="Inter" font-size="16" fill="var(--neutral-700)">Crédit</text>
        </svg>
      </a>
    </div>
    
    <!-- Mobile Toggle -->
    <button class="navbar-toggle" 
            type="button"
            aria-controls="navbar-menu"
            aria-expanded="false"
            aria-label="Ouvrir le menu de navigation"
            data-toggle="navbar">
      <span class="navbar-toggle-bar"></span>
      <span class="navbar-toggle-bar"></span>
      <span class="navbar-toggle-bar"></span>
    </button>
    
    <!-- Navigation Menu -->
    <nav id="navbar-menu" class="navbar-menu" aria-label="Navigation principale">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a href="{% url 'dashboard' %}" 
             class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
             {% if request.resolver_match.url_name == 'dashboard' %}aria-current="page"{% endif %}>
            <svg class="nav-icon" aria-hidden="true">
              <use xlink:href="#icon-dashboard"></use>
            </svg>
            <span>Dashboard</span>
          </a>
        </li>
        
        <li class="nav-item">
          <a href="{% url 'dossiers:list' %}" 
             class="nav-link {% if 'dossiers' in request.path %}active{% endif %}"
             {% if 'dossiers' in request.path %}aria-current="page"{% endif %}>
            <svg class="nav-icon" aria-hidden="true">
              <use xlink:href="#icon-folder"></use>
            </svg>
            <span>Dossiers</span>
          </a>
        </li>
        
        {% if user.is_authenticated %}
        <!-- User Dropdown -->
        <li class="nav-item nav-item-dropdown">
          <button class="nav-link" 
                  type="button"
                  aria-haspopup="true" 
                  aria-expanded="false"
                  data-toggle="dropdown"
                  aria-label="Menu utilisateur">
            <svg class="nav-icon" aria-hidden="true">
              <use xlink:href="#icon-user"></use>
            </svg>
            <span>{{ user.get_full_name|default:user.username }}</span>
            <svg class="nav-chevron" aria-hidden="true">
              <use xlink:href="#icon-chevron-down"></use>
            </svg>
          </button>
          
          <ul class="dropdown-menu" role="menu">
            <li role="none">
              <a href="{% url 'profile' %}" 
                 class="dropdown-item" 
                 role="menuitem">
                <svg class="dropdown-icon" aria-hidden="true">
                  <use xlink:href="#icon-user"></use>
                </svg>
                Mon profil
              </a>
            </li>
            <li role="none">
              <a href="{% url 'settings' %}" 
                 class="dropdown-item" 
                 role="menuitem">
                <svg class="dropdown-icon" aria-hidden="true">
                  <use xlink:href="#icon-settings"></use>
                </svg>
                Paramètres
              </a>
            </li>
            <li role="separator" class="dropdown-divider"></li>
            <li role="none">
              <a href="{% url 'logout' %}" 
                 class="dropdown-item" 
                 role="menuitem">
                <svg class="dropdown-icon" aria-hidden="true">
                  <use xlink:href="#icon-logout"></use>
                </svg>
                Déconnexion
              </a>
            </li>
          </ul>
        </li>
        
        <!-- Notifications -->
        {% if unread_notifications_count > 0 %}
        <li class="nav-item">
          <a href="{% url 'notifications' %}" 
             class="nav-link nav-link-notifications"
             aria-label="{{ unread_notifications_count }} notification(s) non lue(s)">
            <svg class="nav-icon" aria-hidden="true">
              <use xlink:href="#icon-bell"></use>
            </svg>
            <span class="nav-badge" aria-hidden="true">{{ unread_notifications_count }}</span>
          </a>
        </li>
        {% endif %}
        
        {% else %}
        <!-- Not Authenticated -->
        <li class="nav-item">
          <a href="{% url 'login' %}" class="nav-link">
            Connexion
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</header>

<style>
/* Navbar Styles */
.navbar {
  background: white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: var(--z-sticky);
}

.navbar-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--gap-4);
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 64px;
}

.navbar-brand a {
  display: flex;
  align-items: center;
  text-decoration: none;
}

.navbar-logo {
  height: 40px;
}

/* Mobile Toggle */
.navbar-toggle {
  display: none;
  flex-direction: column;
  gap: 4px;
  padding: 8px;
  background: none;
  border: none;
  cursor: pointer;
}

.navbar-toggle-bar {
  width: 24px;
  height: 2px;
  background: var(--neutral-700);
  transition: all var(--transition-base);
}

.navbar-toggle[aria-expanded="true"] .navbar-toggle-bar:nth-child(1) {
  transform: rotate(45deg) translateY(6px);
}

.navbar-toggle[aria-expanded="true"] .navbar-toggle-bar:nth-child(2) {
  opacity: 0;
}

.navbar-toggle[aria-expanded="true"] .navbar-toggle-bar:nth-child(3) {
  transform: rotate(-45deg) translateY(-6px);
}

/* Navigation */
.navbar-nav {
  display: flex;
  align-items: center;
  gap: var(--gap-2);
  list-style: none;
  margin: 0;
  padding: 0;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: var(--gap-2);
  padding: var(--gap-2) var(--gap-4);
  color: var(--neutral-700);
  text-decoration: none;
  border-radius: var(--radius-md);
  font-weight: var(--font-medium);
  transition: all var(--transition-fast);
}

.nav-link:hover {
  background: var(--neutral-100);
  color: var(--brand-500);
}

.nav-link.active {
  background: var(--brand-50);
  color: var(--brand-500);
  font-weight: var(--font-semibold);
}

.nav-icon {
  width: 20px;
  height: 20px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
}

.nav-chevron {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  transition: transform var(--transition-fast);
}

.nav-link[aria-expanded="true"] .nav-chevron {
  transform: rotate(180deg);
}

/* Notifications Badge */
.nav-link-notifications {
  position: relative;
}

.nav-badge {
  position: absolute;
  top: 4px;
  right: 4px;
  background: var(--error-500);
  color: white;
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  padding: 2px 6px;
  border-radius: var(--radius-full);
  min-width: 18px;
  text-align: center;
}

/* Dropdown */
.nav-item-dropdown {
  position: relative;
}

.dropdown-menu {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background: white;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  min-width: 200px;
  padding: var(--gap-2);
  list-style: none;
  margin: 0;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all var(--transition-fast);
  z-index: var(--z-dropdown);
}

.nav-item-dropdown.is-open .dropdown-menu {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: var(--gap-2);
  padding: var(--gap-2) var(--gap-3);
  color: var(--neutral-700);
  text-decoration: none;
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  transition: all var(--transition-fast);
}

.dropdown-item:hover {
  background: var(--neutral-100);
  color: var(--brand-500);
}

.dropdown-icon {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
}

.dropdown-divider {
  height: 1px;
  background: var(--neutral-200);
  margin: var(--gap-2) 0;
}

/* Responsive */
@media (max-width: 768px) {
  .navbar-toggle {
    display: flex;
  }
  
  .navbar-menu {
    position: fixed;
    top: 64px;
    left: 0;
    right: 0;
    background: white;
    box-shadow: var(--shadow-lg);
    padding: var(--gap-4);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-base);
  }
  
  .navbar-menu.is-open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .navbar-nav {
    flex-direction: column;
    align-items: stretch;
  }
  
  .nav-link {
    justify-content: flex-start;
  }
  
  .dropdown-menu {
    position: static;
    opacity: 1;
    visibility: visible;
    transform: none;
    box-shadow: none;
    margin-top: var(--gap-2);
    padding-left: var(--gap-4);
  }
}
</style>
