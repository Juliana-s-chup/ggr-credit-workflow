{% extends "suivi_demande/dashboard_base.html" %}
{% load static %}

{% block title %}Dashboard Client{% endblock %}
{% block dashboard_role %}Espace Client{% endblock %}
{% block user_role %}Client{% endblock %}
{% block page_title %}Mon Espace Personnel{% endblock %}
{% block header_icon %}fas fa-user-circle{% endblock %}

{% block extra_css %}
<style>
/* Palette client rouge/or selon mémoire utilisateur */
:root {
    --client-rouge: #6a1919;
    --client-or: #e0c78c;
}
.sidebar-banking { background: linear-gradient(180deg, var(--client-rouge) 0%, #5a1515 100%); }
.nav-item-banking.active { background: var(--client-or); color: var(--client-rouge); }
.dashboard-title { color: var(--client-rouge); }
.kpi-card { border-left-color: var(--client-or); }

/* Styles pour la modal */
.notif-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 50;
}
.notif-modal-content {
    max-width: 560px;
    margin: 10vh auto;
    box-shadow: var(--shadow-lg);
}
</style>
{% endblock %}

{% block navigation %}
<a href="#" class="nav-item-banking active" data-section="dashboard">
    <i class="fas fa-tachometer-alt"></i>
    <span>Tableau de Bord</span>
</a>
<a href="#" class="nav-item-banking" data-section="dossiers">
    <i class="fas fa-folder"></i>
    <span>Mes Dossiers</span>
    <span class="badge badge-info ml-auto">3</span>
</a>
<a href="#" class="nav-item-banking" data-section="nouvelle-demande">
    <i class="fas fa-plus-circle"></i>
    <span>Nouvelle Demande</span>
</a>
<a href="#" class="nav-item-banking" data-section="profil">
    <i class="fas fa-user-cog"></i>
    <span>Mon Profil</span>
</a>
{% endblock %}

{% block stats_cards %}
<div class="kpi-card">
    <div class="kpi-value">3</div>
    <div class="kpi-label">Mes Dossiers</div>
</div>
<div class="kpi-card">
    <div class="kpi-value">1</div>
    <div class="kpi-label">Approuvés</div>
</div>
<div class="kpi-card">
    <div class="kpi-value">15 000 000 FCFA</div>
    <div class="kpi-label">Montant Total</div>
</div>
<div class="kpi-card">
    <div class="kpi-value">2</div>
    <div class="kpi-label">Notifications</div>
</div>
{% endblock %}

{% block content %}
<!-- Dashboard Section -->
<section class="content-section active" id="dashboard-section">
    <div class="stats-grid mb-8">
        <!-- Les KPIs sont déjà définis dans le bloc stats_cards ci-dessus -->
    </div>
    
    <div class="grid md:grid-cols-2 gap-6">
        <div class="card">
            <div class="card-header">
                <h3 class="text-lg font-semibold">Dossiers Récents</h3>
            </div>
            <div class="card-body">
                <!-- Dossier 1 -->
                <div class="border-l-4 border-client-or bg-yellow-50 p-4 mb-3 rounded">
                    <div class="font-semibold">CRD-2024-001</div>
                    <div class="text-sm text-muted">Crédit Immobilier</div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="badge badge-en-cours">En cours</span>
                        <span class="font-semibold">10 000 000 FCFA</span>
                    </div>
                </div>
                
                <!-- Dossier 2 -->
                <div class="border-l-4 border-client-or bg-yellow-50 p-4 mb-3 rounded">
                    <div class="font-semibold">CRD-2024-002</div>
                    <div class="text-sm text-muted">Crédit Auto</div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="badge badge-approuve">Approuvé</span>
                        <span class="font-semibold">5 000 000 FCFA</span>
                    </div>
                </div>
                
                <!-- Dossier 3 -->
                <div class="border-l-4 border-client-or bg-yellow-50 p-4 mb-3 rounded">
                    <div class="font-semibold">CRD-2024-003</div>
                    <div class="text-sm text-muted">Crédit Personnel</div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="badge badge-en-attente">En attente</span>
                        <span class="font-semibold">2 500 000 FCFA</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3 class="text-lg font-semibold">Notifications</h3>
            </div>
            <div class="card-body">
                <div class="space-y-3">
                    <!-- Notification 1 -->
                    <div class="p-3 bg-blue-50 border-info border-l-4 rounded" 
                         data-open="notif-modal" 
                         data-title="Mise à jour de dossier" 
                         data-ref="CRD-2024-001" 
                         data-time="Il y a 2 heures" 
                         data-content="Votre dossier de crédit immobilier a été mis à jour. Un nouvel document est requis pour poursuivre le traitement.">
                        <div class="font-medium">Mise à jour de dossier</div>
                        <div class="text-xs text-muted">Il y a 2 heures</div>
                    </div>
                    
                    <!-- Notification 2 -->
                    <div class="p-3 bg-yellow-50 border-warning border-l-4 rounded" 
                         data-open="notif-modal" 
                         data-title="Dossier approuvé" 
                         data-ref="CRD-2024-002" 
                         data-time="Il y a 1 jour" 
                         data-content="Félicitations ! Votre demande de crédit auto a été approuvée. Vous recevrez les fonds sous 48h.">
                        <div class="font-medium">Dossier approuvé</div>
                        <div class="text-xs text-muted">Il y a 1 jour</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Mes Dossiers Section -->
<section class="content-section" id="dossiers-section">
    <div class="card">
        <div class="card-header">
            <h3 class="text-lg font-semibold">Mes Dossiers de Crédit</h3>
        </div>
        <div class="card-body">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left py-3">Référence</th>
                            <th class="text-left py-3">Produit</th>
                            <th class="text-left py-3">Montant</th>
                            <th class="text-left py-3">Statut</th>
                            <th class="text-left py-3">Date</th>
                            <th class="text-left py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-4">CRD-2024-001</td>
                            <td class="py-4">Crédit Immobilier</td>
                            <td class="py-4 font-semibold">10 000 000 FCFA</td>
                            <td class="py-4">
                                <span class="badge badge-en-cours">En cours</span>
                            </td>
                            <td class="py-4">15/10/2024</td>
                            <td class="py-4">
                                <button class="btn btn-secondary btn-sm">
                                    <i class="fas fa-eye"></i> Voir
                                </button>
                            </td>
                        </tr>
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-4">CRD-2024-002</td>
                            <td class="py-4">Crédit Auto</td>
                            <td class="py-4 font-semibold">5 000 000 FCFA</td>
                            <td class="py-4">
                                <span class="badge badge-approuve">Approuvé</span>
                            </td>
                            <td class="py-4">10/10/2024</td>
                            <td class="py-4">
                                <button class="btn btn-secondary btn-sm">
                                    <i class="fas fa-eye"></i> Voir
                                </button>
                            </td>
                        </tr>
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-4">CRD-2024-003</td>
                            <td class="py-4">Crédit Personnel</td>
                            <td class="py-4 font-semibold">2 500 000 FCFA</td>
                            <td class="py-4">
                                <span class="badge badge-en-attente">En attente</span>
                            </td>
                            <td class="py-4">05/10/2024</td>
                            <td class="py-4">
                                <button class="btn btn-secondary btn-sm">
                                    <i class="fas fa-eye"></i> Voir
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<!-- Nouvelle Demande Section -->
<section class="content-section" id="nouvelle-demande-section">
    <div class="card">
        <div class="card-header">
            <h3 class="text-lg font-semibold">Nouvelle Demande de Crédit</h3>
        </div>
        <div class="card-body">
            <div class="grid md:grid-cols-3 gap-6">
                <div class="card border-2 border-dashed border-gray-300 hover:border-client-or cursor-pointer transition-all duration-300">
                    <div class="card-body text-center">
                        <i class="fas fa-home text-3xl text-client-or mb-4"></i>
                        <h4 class="font-semibold mb-2">Crédit Immobilier</h4>
                        <p class="text-sm text-muted mb-4">Financement pour l'achat d'un bien immobilier</p>
                        <button class="btn btn-primary btn-sm">Choisir</button>
                    </div>
                </div>
                <div class="card border-2 border-dashed border-gray-300 hover:border-client-or cursor-pointer transition-all duration-300">
                    <div class="card-body text-center">
                        <i class="fas fa-car text-3xl text-client-or mb-4"></i>
                        <h4 class="font-semibold mb-2">Crédit Auto</h4>
                        <p class="text-sm text-muted mb-4">Financement pour l'achat d'un véhicule</p>
                        <button class="btn btn-primary btn-sm">Choisir</button>
                    </div>
                </div>
                <div class="card border-2 border-dashed border-gray-300 hover:border-client-or cursor-pointer transition-all duration-300">
                    <div class="card-body text-center">
                        <i class="fas fa-briefcase text-3xl text-client-or mb-4"></i>
                        <h4 class="font-semibold mb-2">Crédit Personnel</h4>
                        <p class="text-sm text-muted mb-4">Financement pour vos projets personnels</p>
                        <button class="btn btn-primary btn-sm">Choisir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Profil Section -->
<section class="content-section" id="profil-section">
    <div class="grid md:grid-cols-2 gap-6">
        <div class="card">
            <div class="card-header">
                <h3 class="text-lg font-semibold">Informations Personnelles</h3>
            </div>
            <div class="card-body">
                <form class="space-y-4">
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" class="form-input" value="Jean Dupont">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" value="jean.dupont@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Téléphone</label>
                        <input type="tel" class="form-input" value="+33 6 12 34 56 78">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Adresse</label>
                        <input type="text" class="form-input" value="123 Avenue de la République, 75001 Paris">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Mettre à jour
                    </button>
                </form>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3 class="text-lg font-semibold">Sécurité</h3>
            </div>
            <div class="card-body">
                <div class="space-y-4">
                    <button class="btn btn-secondary w-full">
                        <i class="fas fa-key mr-2"></i> Changer le mot de passe
                    </button>
                    <button class="btn btn-secondary w-full">
                        <i class="fas fa-shield-alt mr-2"></i> Authentification à deux facteurs
                    </button>
                    <button class="btn btn-secondary w-full">
                        <i class="fas fa-bell mr-2"></i> Préférences de notifications
                    </button>
                </div>
                
                <div class="mt-6 p-4 bg-gray-50 rounded">
                    <h4 class="font-semibold mb-2">Dernière connexion</h4>
                    <p class="text-sm text-muted">Aujourd'hui à 14:30 depuis Paris, France</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Notification Modal -->
<div id="notif-modal" class="notif-modal">
    <div class="notif-modal-content">
        <div class="card">
            <div class="card-header flex justify-between items-center">
                <h3 class="text-lg font-semibold" id="notif-modal-title">Notification</h3>
                <button class="btn btn-secondary btn-sm" data-close="notif-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="card-body">
                <div class="text-sm text-muted mb-2" id="notif-modal-meta"></div>
                <div id="notif-modal-content" class="prose max-w-none"></div>
            </div>
            <div class="card-footer flex justify-end gap-2">
                <button class="btn btn-secondary" data-close="notif-modal">Fermer</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
// Modal notifications (navigation & script wrapper gérés dans le template de base)
(function(){
  const notifModal = document.getElementById('notif-modal');
  const title = document.getElementById('notif-modal-title');
  const meta = document.getElementById('notif-modal-meta');
  const content = document.getElementById('notif-modal-content');

  document.addEventListener('click', function(e){
    const openEl = e.target.closest('[data-open="notif-modal"]');
    if (openEl) {
      const t = openEl.getAttribute('data-title') || 'Notification';
      const ref = openEl.getAttribute('data-ref') || '';
      const time = openEl.getAttribute('data-time') || '';
      const body = openEl.getAttribute('data-content') || '';
      title.textContent = t;
      meta.textContent = ref && time ? `${ref} • ${time}` : (ref || time);
      content.textContent = body;
      notifModal.style.display = 'block';
      return;
    }
    const closeEl = e.target.closest('[data-close="notif-modal"]');
    if (closeEl || (e.target === notifModal)) {
      notifModal.style.display = 'none';
      return;
    }
  });
})();
{% endblock %}